/**
 * sparse-octree v4.0.2 build Sep 14 2017
 * https://github.com/vanruesc/sparse-octree
 * Copyright 2017 Raoul van RÃ¼schen, Zlib
 */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.SPARSEOCTREE={})}(this,function(t){"use strict";function i(t,i,e){return Math.max(Math.min(t,e),i)}function e(t,i,e,n,s,r){var h=0;return t>i&&t>e?(s<t&&(h|=2),r<t&&(h|=1)):i>e?(n<i&&(h|=4),r<i&&(h|=1)):(n<e&&(h|=4),s<e&&(h|=2)),h}function n(t,i,e,n){var s=void 0,r=0;return i<e?(s=i,r=0):(s=e,r=1),n<s&&(r=2),K[t][r]}function s(t,i,r,h,a,u,o,l,c){var y=t.children,v=void 0,d=void 0,f=void 0,m=void 0;if(a>=0&&u>=0&&o>=0)if(null===y)c.push(t);else{v=e(i,r,h,d=.5*(i+a),f=.5*(r+u),m=.5*(h+o));do{switch(v){case 0:s(y[J[8]],i,r,h,d,f,m,l,c),v=n(v,d,f,m);break;case 1:s(y[J[8]^J[1]],i,r,m,d,f,o,l,c),v=n(v,d,f,o);break;case 2:s(y[J[8]^J[2]],i,f,h,d,u,m,l,c),v=n(v,d,u,m);break;case 3:s(y[J[8]^J[3]],i,f,m,d,u,o,l,c),v=n(v,d,u,o);break;case 4:s(y[J[8]^J[4]],d,r,h,a,f,m,l,c),v=n(v,a,f,m);break;case 5:s(y[J[8]^J[5]],d,r,m,a,f,o,l,c),v=n(v,a,f,o);break;case 6:s(y[J[8]^J[6]],d,f,h,a,u,m,l,c),v=n(v,a,u,m);break;case 7:s(y[J[8]^J[7]],d,f,m,a,u,o,l,c),v=8}}while(v<8)}}function r(t){var i=t.children,e=0,n=void 0,s=void 0,h=void 0;if(null!==i)for(n=0,s=i.length;n<s;++n)(h=1+r(i[n]))>e&&(e=h);return e}function h(t,i,e){var n=t.children,s=void 0,r=void 0;if(ht.min=t.min,ht.max=t.max,i.intersectsBox(ht))if(null!==n)for(s=0,r=n.length;s<r;++s)h(n[s],i,e);else e.push(t)}function a(t,i,e,n){var s=t.children,r=void 0,h=void 0;if(e===i)n.push(t);else if(null!==s)for(++e,r=0,h=s.length;r<h;++r)a(s[r],i,e,n)}function u(t){var i=t.children,e=0,n=void 0,s=void 0;if(null!==i)for(n=0,s=i.length;n<s;++n)e+=u(i[n]);else null!==t.points&&(e=t.points.length);return e}function o(t,i,e,n,s){var r=n.children,h=!1,a=!1,u=void 0,l=void 0;if(n.contains(t,e.bias)){if(null===r){if(null===n.points)n.points=[],n.data=[];else for(u=0,l=n.points.length;!h&&u<l;++u)h=n.points[u].equals(t);h?(n.data[u-1]=i,a=!0):n.points.length<e.maxPoints||s===e.maxDepth?(n.points.push(t.clone()),n.data.push(i),++e.pointCount,a=!0):(n.split(),n.redistribute(e.bias),r=n.children)}if(null!==r)for(++s,u=0,l=r.length;!a&&u<l;++u)a=o(t,i,e,r[u],s)}return a}function l(t,i,e,n){var s=e.children,r=null,h=void 0,a=void 0,o=void 0,c=void 0,y=void 0;if(e.contains(t,i.bias))if(null!==s)for(h=0,a=s.length;null===r&&h<a;++h)r=l(t,i,s[h],e);else if(null!==e.points)for(o=e.points,c=e.data,h=0,a=o.length;h<a;++h)if(o[h].equals(t)){y=a-1,r=c[h],h<y&&(o[h]=o[y],c[h]=c[y]),o.pop(),c.pop(),--i.pointCount,null!==n&&u(n)<=i.maxPoints&&n.merge();break}return r}function c(t,i,e){var n=e.children,s=null,r=void 0,h=void 0,a=void 0;if(e.contains(t,i.bias))if(null!==n)for(r=0,h=n.length;null===s&&r<h;++r)s=c(t,i,n[r]);else for(r=0,h=(a=e.points).length;null===s&&r<h;++r)t.distanceToSquared(a[r])<=ct&&(s=e.data[r]);return s}function y(t,i,e,n,s,r){var h=n.children,a=null,u=void 0,c=void 0,v=void 0;if(n.contains(t,e.bias))if(n.contains(i,e.bias)){if(null!==h)for(++r,u=0,c=h.length;null===a&&u<c;++u)a=y(t,i,e,h[u],n,r);else for(u=0,c=(v=n.points).length;u<c;++u)if(t.distanceToSquared(v[u])<=ct){v[u].copy(i),a=n.data[u];break}}else o(i,a=l(t,e,n,s),e,s,r-1);return a}function v(t,i,e,n){var s=n.points,r=n.children,h=null,a=i,u=void 0,o=void 0,l=void 0,c=void 0,y=void 0,d=void 0,f=void 0;if(null!==r)for(u=0,o=(y=r.map(function(i){return{octant:i,distance:i.distanceToCenterSquared(t)}}).sort(function(t,i){return t.distance-i.distance})).length;u<o;++u)(d=y[u].octant).contains(t,a)&&null!==(f=v(t,a,e,d))&&(c=f.point.distanceToSquared(t),(!e||c>0)&&c<a&&(a=c,h=f));else if(null!==s)for(u=0,o=s.length;u<o;++u)l=s[u],c=t.distanceToSquared(l),(!e||c>0)&&c<a&&(a=c,h={point:l.clone(),data:n.data[u]});return h}function d(t,i,e,n,s){var r=n.points,h=n.children,a=i*i,u=void 0,o=void 0,l=void 0,c=void 0,y=void 0;if(null!==h)for(u=0,o=h.length;u<o;++u)(y=h[u]).contains(t,i)&&d(t,i,e,y,s);else if(null!==r)for(u=0,o=r.length;u<o;++u)l=r[u],c=t.distanceToSquared(l),(!e||c>0)&&c<=a&&s.push({point:l.clone(),data:n.data[u]})}!function(){function t(t){this.value=t}function i(i){function e(s,r){try{var h=i[s](r),a=h.value;a instanceof t?Promise.resolve(a.value).then(function(t){e("next",t)},function(t){e("throw",t)}):n(h.done?"return":"normal",h.value)}catch(t){n("throw",t)}}function n(t,i){switch(t){case"return":s.resolve({value:i,done:!0});break;case"throw":s.reject(i);break;default:s.resolve({value:i,done:!1})}(s=s.next)?e(s.key,s.arg):r=null}var s,r;this._invoke=function(t,i){return new Promise(function(n,h){var a={key:t,arg:i,resolve:n,reject:h,next:null};r?r=r.next=a:(s=r=a,e(t,i))})},"function"!=typeof i.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(t){return this._invoke("next",t)},i.prototype.throw=function(t){return this._invoke("throw",t)},i.prototype.return=function(t){return this._invoke("return",t)}}();var f=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),x=function t(i,e,n){null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,e);if(void 0===s){var r=Object.getPrototypeOf(i);return null===r?void 0:t(r,e,n)}if("value"in s)return s.value;var h=s.get;if(void 0!==h)return h.call(n)},k=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)},p=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i},z=function(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)},w=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),this.x=i,this.y=e,this.z=n}return m(t,[{key:"set",value:function(t,i,e){return this.x=t,this.y=i,this.z=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,i){return this.fromArray(t.elements,4*i)}},{key:"setFromMatrixPosition",value:function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}},{key:"setFromMatrixScale",value:function(t){var i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"cross",value:function(t){var i=this.x,e=this.y,n=this.z;return this.x=e*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-e*t.x,this}},{key:"crossVectors",value:function(t,i){var e=t.x,n=t.y,s=t.z,r=i.x,h=i.y,a=i.z;return this.x=n*a-s*h,this.y=s*r-e*a,this.z=e*h-n*r,this}},{key:"applyMatrix3",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*n,this.y=s[1]*i+s[4]*e+s[7]*n,this.z=s[2]*i+s[5]*e+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n+s[12],this.y=s[1]*i+s[5]*e+s[9]*n+s[13],this.z=s[2]*i+s[6]*e+s[10]*n+s[14],this}},{key:"applyQuaternion",value:function(t){var i=this.x,e=this.y,n=this.z,s=t.x,r=t.y,h=t.z,a=t.w,u=a*i+r*n-h*e,o=a*e+h*i-s*n,l=a*n+s*e-r*i,c=-s*i-r*e-h*n;return this.x=u*a+c*-s+o*-h-l*-r,this.y=o*a+c*-r+l*-s-u*-h,this.z=l*a+c*-h+u*-r-o*-s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(i){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;var e=i.x,n=i.y,s=i.z;return this.sub(i.multiplyScalar(2*this.dot(i))),i.set(e,n,s),this}},{key:"angleTo",value:function(t){var i=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(i,-1),1))}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),t}(),M=new w,g=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w(-1/0,-1/0,-1/0);f(this,t),this.min=i,this.max=e}return m(t,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S;return this.getCenter(t.center),t.radius=.5*this.getSize(M).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var i=void 0,e=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var e=M.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return M.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,M).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var i=void 0,e=void 0;return t.normal.x>0?(i=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),i<=t.constant&&e>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),b=new g,S=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.center=i,this.radius=e}return m(t,[{key:"set",value:function(t,i){return this.center.copy(t),this.radius=i,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.setFromPoints(t).getCenter(this.center);var i=this.center,e=0,n=void 0,s=void 0;for(n=0,s=t.length;n<s;++n)e=Math.max(e,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(e),this}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w,e=this.center.distanceToSquared(t);return i.copy(t),e>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),t}(),q=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.x=i,this.y=e}return m(t,[{key:"set",value:function(t,i){return this.x=t,this.y=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var i=this.x,e=this.y,n=t.elements;return this.x=n[0]*i+n[3]*e+n[6],this.y=n[1]*i+n[4]*e+n[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"rotateAround",value:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=this.x-t.x,r=this.y-t.y;return this.x=s*e-r*n+t.x,this.y=s*n+r*e+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),t}(),P=new q,A=(function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new q(1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q(-1/0,-1/0);f(this,t),this.min=i,this.max=e}m(t,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new q;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new q;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S;return this.getCenter(t.center),t.radius=.5*this.getSize(P).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var i=void 0,e=void 0;for(this.min.set(0,0),this.max.set(0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var e=P.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return P.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),this.radius=i,this.theta=e,this.y=n}m(t,[{key:"set",value:function(t,i,e){return this.radius=t,this.theta=i,this.y=e,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return m(t,[{key:"set",value:function(t,i,e,n,s,r,h,a,u){var o=this.elements;return o[0]=t,o[3]=i,o[6]=e,o[1]=n,o[4]=s,o[7]=r,o[2]=h,o[5]=a,o[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<9;++n)e[n]=t[n+i];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<9;++n)t[n+i]=e[n];return t}},{key:"multiplyMatrices",value:function(t,i){var e=t.elements,n=i.elements,s=this.elements,r=e[0],h=e[3],a=e[6],u=e[1],o=e[4],l=e[7],c=e[2],y=e[5],v=e[8],d=n[0],f=n[3],m=n[6],x=n[1],k=n[4],p=n[7],z=n[2],w=n[5],M=n[8];return s[0]=r*d+h*x+a*z,s[3]=r*f+h*k+a*w,s[6]=r*m+h*p+a*M,s[1]=u*d+o*x+l*z,s[4]=u*f+o*k+l*w,s[7]=u*m+o*p+l*M,s[2]=c*d+y*x+v*z,s[5]=c*f+y*k+v*w,s[8]=c*m+y*p+v*M,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,i=t[0],e=t[1],n=t[2],s=t[3],r=t[4],h=t[5],a=t[6],u=t[7],o=t[8];return i*r*o-i*h*u-e*s*o+e*h*a+n*s*u-n*r*a}},{key:"getInverse",value:function(t){var i=t.elements,e=this.elements,n=i[0],s=i[1],r=i[2],h=i[3],a=i[4],u=i[5],o=i[6],l=i[7],c=i[8],y=c*a-u*l,v=u*o-c*h,d=l*h-a*o,f=n*y+s*v+r*d,m=void 0;return 0!==f?(m=1/f,e[0]=y*m,e[1]=(r*l-c*s)*m,e[2]=(u*s-r*a)*m,e[3]=v*m,e[4]=(c*n-r*o)*m,e[5]=(r*h-u*n)*m,e[6]=d*m,e[7]=(s*o-l*n)*m,e[8]=(a*n-s*h)*m):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,i=void 0;return i=t[1],t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this}},{key:"scale",value:function(t,i){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this}},{key:"rotate",value:function(t){var i=Math.cos(t),e=Math.sin(t),n=this.elements,s=n[0],r=n[3],h=n[6],a=n[1],u=n[4],o=n[7];return n[0]=i*s+e*a,n[3]=i*r+e*u,n[6]=i*h+e*o,n[1]=-e*s+i*a,n[4]=-e*r+i*u,n[7]=-e*h+i*o,this}},{key:"translate",value:function(t,i){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<9;++s)i[s]!==e[s]&&(n=!1);return n}}]),t}()),T={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},F=new w,V=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;f(this,t),this.x=i,this.y=i,this.z=i,this.w=i}return m(t,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},{key:"setFromEuler",value:function(t){var i=t.x,e=t.y,n=t.z,s=Math.cos,r=Math.sin,h=s(i/2),a=s(e/2),u=s(n/2),o=r(i/2),l=r(e/2),c=r(n/2);switch(t.order){case T.XYZ:this.x=o*a*u+h*l*c,this.y=h*l*u-o*a*c,this.z=h*a*c+o*l*u,this.w=h*a*u-o*l*c;break;case T.YXZ:this.x=o*a*u+h*l*c,this.y=h*l*u-o*a*c,this.z=h*a*c-o*l*u,this.w=h*a*u+o*l*c;break;case T.ZXY:this.x=o*a*u-h*l*c,this.y=h*l*u+o*a*c,this.z=h*a*c+o*l*u,this.w=h*a*u-o*l*c;break;case T.ZYX:this.x=o*a*u-h*l*c,this.y=h*l*u+o*a*c,this.z=h*a*c-o*l*u,this.w=h*a*u+o*l*c;break;case T.YZX:this.x=o*a*u+h*l*c,this.y=h*l*u+o*a*c,this.z=h*a*c-o*l*u,this.w=h*a*u-o*l*c;break;case T.XZY:this.x=o*a*u-h*l*c,this.y=h*l*u-o*a*c,this.z=h*a*c+o*l*u,this.w=h*a*u+o*l*c}return this}},{key:"setFromAxisAngle",value:function(t,i){var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this}},{key:"setFromRotationMatrix",value:function(t){var i=t.elements,e=i[0],n=i[4],s=i[8],r=i[1],h=i[5],a=i[9],u=i[2],o=i[6],l=i[10],c=e+h+l,y=void 0;return c>0?(y=.5/Math.sqrt(c+1),this.w=.25/y,this.x=(o-a)*y,this.y=(s-u)*y,this.z=(r-n)*y):e>h&&e>l?(y=2*Math.sqrt(1+e-h-l),this.w=(o-a)/y,this.x=.25*y,this.y=(n+r)/y,this.z=(s+u)/y):h>l?(y=2*Math.sqrt(1+h-e-l),this.w=(s-u)/y,this.x=(n+r)/y,this.y=.25*y,this.z=(a+o)/y):(y=2*Math.sqrt(1+l-e-h),this.w=(r-n)/y,this.x=(s+u)/y,this.y=(a+o)/y,this.z=.25*y),this}},{key:"setFromUnitVectors",value:function(t,i){var e=t.dot(i)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?F.set(-t.y,t.x,0):F.set(0,-t.z,t.y)):F.crossVectors(t,i),this.x=F.x,this.y=F.y,this.z=F.z,this.w=e,this.normalize()}},{key:"invert",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),i=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(i=1/t,this.x=this.x*i,this.y=this.y*i,this.z=this.z*i,this.w=this.w*i),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,i){var e=t.x,n=t.y,s=t.z,r=t.w,h=i.x,a=i.y,u=i.z,o=i.w;return this.x=e*o+r*h+n*u-s*a,this.y=n*o+r*a+s*h-e*u,this.z=s*o+r*u+e*a-n*h,this.w=r*o-e*h-n*a-s*u,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,i){var e=this.x,n=this.y,s=this.z,r=this.w,h=void 0,a=void 0,u=void 0,o=void 0,l=void 0;if(1===i)this.copy(t);else if(i>0){if((h=r*t.w+e*t.x+n*t.y+s*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,h=-h):this.copy(t),h>=1)return this.w=r,this.x=e,this.y=n,this.z=s,this;if(a=Math.sqrt(1-h*h),Math.abs(a)<.001)return this.w=.5*(r+this.w),this.x=.5*(e+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;u=Math.atan2(a,h),o=Math.sin((1-i)*u)/a,l=Math.sin(i*u)/a,this.w=r*o+this.w*l,this.x=e*o+this.x*l,this.y=n*o+this.y*l,this.z=s*o+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(i,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t,s=arguments[3];return n.copy(i).slerp(e,s)}},{key:"slerpFlat",value:function(t,i,e,n,s,r,h){var a=s[r],u=s[r+1],o=s[r+2],l=s[r+3],c=e[n],y=e[n+1],v=e[n+2],d=e[n+3],f=void 0,m=void 0,x=void 0,k=void 0,p=void 0,z=void 0,w=void 0,M=void 0;d===l&&c===a&&y===u&&v===o||(f=1-h,z=(k=c*a+y*u+v*o+d*l)>=0?1:-1,(p=1-k*k)>Number.EPSILON&&(x=Math.sqrt(p),w=Math.atan2(x,k*z),f=Math.sin(f*w)/x,h=Math.sin(h*w)/x),c=c*f+a*(M=h*z),y=y*f+u*M,v=v*f+o*M,d=d*f+l*M,f===1-h&&(c*=m=1/Math.sqrt(c*c+y*y+v*v+d*d),y*=m,v*=m,d*=m)),t[i]=c,t[i+1]=y,t[i+2]=v,t[i+3]=d}}]),t}(),C=new A,O=new V,X=(function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),this.x=i,this.y=e,this.z=n,this.order=t.defaultOrder}m(t,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.order=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.order=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.order,t}},{key:"toVector3",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order,n=t.elements,s=n[0],r=n[4],h=n[8],a=n[1],u=n[5],o=n[9],l=n[2],c=n[6],y=n[10];switch(e){case T.XYZ:this.y=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-o,y),this.z=Math.atan2(-r,s)):(this.x=Math.atan2(c,u),this.z=0);break;case T.YXZ:this.x=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this.y=Math.atan2(h,y),this.z=Math.atan2(a,u)):(this.y=Math.atan2(-l,s),this.z=0);break;case T.ZXY:this.x=Math.asin(i(c,-1,1)),Math.abs(c)<.99999?(this.y=Math.atan2(-l,y),this.z=Math.atan2(-r,u)):(this.y=0,this.z=Math.atan2(a,s));break;case T.ZYX:this.y=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this.x=Math.atan2(c,y),this.z=Math.atan2(a,s)):(this.x=0,this.z=Math.atan2(-r,u));break;case T.YZX:this.z=Math.asin(i(a,-1,1)),Math.abs(a)<.99999?(this.x=Math.atan2(-o,u),this.y=Math.atan2(-l,s)):(this.x=0,this.y=Math.atan2(h,y));break;case T.XZY:this.z=Math.asin(-i(r,-1,1)),Math.abs(r)<.99999?(this.x=Math.atan2(c,u),this.y=Math.atan2(h,s)):(this.x=Math.atan2(-o,y),this.y=0)}return this.order=e,this}},{key:"setFromQuaternion",value:function(t,i){return C.makeRotationFromQuaternion(t),this.setFromRotationMatrix(C,i)}},{key:"setFromVector3",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,i)}},{key:"reorder",value:function(t){return O.setFromEuler(this),this.setFromQuaternion(O,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return T.XYZ}}])}(),new w),Y=new w,Z=(function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w;f(this,t),this.start=i,this.end=e}m(t,[{key:"set",value:function(t,i){return this.start.copy(t),this.end.copy(i),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,i){X.subVectors(t,this.start),Y.subVectors(this.end,this.start);var e=Y.dot(Y),n=Y.dot(X);return i?Math.min(Math.max(n/e,0),1):n/e}},{key:"closestPointToPoint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w,n=this.closestPointToPointParameter(t,i);return this.delta(e).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}])}(),new w),U=new w,B=new w,E=(function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}m(t,[{key:"set",value:function(t,i,e,n,s,r,h,a,u,o,l,c,y,v,d,f){var m=this.elements;return m[0]=t,m[4]=i,m[8]=e,m[12]=n,m[1]=s,m[5]=r,m[9]=h,m[13]=a,m[2]=u,m[6]=o,m[10]=l,m[14]=c,m[3]=y,m[7]=v,m[11]=d,m[15]=f,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<16;++n)e[n]=t[n+i];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.elements,n=void 0;for(n=0;n<16;++n)t[n+i]=e[n];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,n))}},{key:"copyPosition",value:function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this}},{key:"setPosition",value:function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this}},{key:"extractBasis",value:function(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var i=this.elements,e=t.elements,n=1/Z.setFromMatrixColumn(t,0).length(),s=1/Z.setFromMatrixColumn(t,1).length(),r=1/Z.setFromMatrixColumn(t,2).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[8]=e[8]*r,i[9]=e[9]*r,i[10]=e[10]*r,this}},{key:"makeRotationFromEuler",value:function(t){var i=this.elements,e=t.x,n=t.y,s=t.z,r=Math.cos(e),h=Math.sin(e),a=Math.cos(n),u=Math.sin(n),o=Math.cos(s),l=Math.sin(s),c=void 0,y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0,k=void 0,p=void 0,z=void 0,w=void 0,M=void 0;switch(t.order){case T.XYZ:c=r*o,y=r*l,v=h*o,d=h*l,i[0]=a*o,i[4]=-a*l,i[8]=u,i[1]=y+v*u,i[5]=c-d*u,i[9]=-h*a,i[2]=d-c*u,i[6]=v+y*u,i[10]=r*a;break;case T.YXZ:f=a*o,m=a*l,x=u*o,k=u*l,i[0]=f+k*h,i[4]=x*h-m,i[8]=r*u,i[1]=r*l,i[5]=r*o,i[9]=-h,i[2]=m*h-x,i[6]=k+f*h,i[10]=r*a;break;case T.ZXY:f=a*o,m=a*l,x=u*o,k=u*l,i[0]=f-k*h,i[4]=-r*l,i[8]=x+m*h,i[1]=m+x*h,i[5]=r*o,i[9]=k-f*h,i[2]=-r*u,i[6]=h,i[10]=r*a;break;case T.ZYX:c=r*o,y=r*l,v=h*o,d=h*l,i[0]=a*o,i[4]=v*u-y,i[8]=c*u+d,i[1]=a*l,i[5]=d*u+c,i[9]=y*u-v,i[2]=-u,i[6]=h*a,i[10]=r*a;break;case T.YZX:p=r*a,z=r*u,w=h*a,M=h*u,i[0]=a*o,i[4]=M-p*l,i[8]=w*l+z,i[1]=l,i[5]=r*o,i[9]=-h*o,i[2]=-u*o,i[6]=z*l+w,i[10]=p-M*l;break;case T.XZY:p=r*a,z=r*u,w=h*a,M=h*u,i[0]=a*o,i[4]=-l,i[8]=u*o,i[1]=p*l+M,i[5]=r*o,i[9]=z*l-w,i[2]=w*l-z,i[6]=h*o,i[10]=M*l+p}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){var i=this.elements,e=t.x,n=t.y,s=t.z,r=t.w,h=e+e,a=n+n,u=s+s,o=e*h,l=e*a,c=e*u,y=n*a,v=n*u,d=s*u,f=r*h,m=r*a,x=r*u;return i[0]=1-(y+d),i[4]=l-x,i[8]=c+m,i[1]=l+x,i[5]=1-(o+d),i[9]=v-f,i[2]=c-m,i[6]=v+f,i[10]=1-(o+y),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}},{key:"lookAt",value:function(t,i,e){var n=this.elements,s=Z,r=U,h=B;return h.subVectors(t,i),0===h.lengthSquared()&&(h.z=1),h.normalize(),s.crossVectors(e,h),0===s.lengthSquared()&&(1===Math.abs(e.z)?h.x+=1e-4:h.z+=1e-4,h.normalize(),s.crossVectors(e,h)),s.normalize(),r.crossVectors(h,s),n[0]=s.x,n[4]=r.x,n[8]=h.x,n[1]=s.y,n[5]=r.y,n[9]=h.y,n[2]=s.z,n[6]=r.z,n[10]=h.z,this}},{key:"multiplyMatrices",value:function(t,i){var e=this.elements,n=t.elements,s=i.elements,r=n[0],h=n[4],a=n[8],u=n[12],o=n[1],l=n[5],c=n[9],y=n[13],v=n[2],d=n[6],f=n[10],m=n[14],x=n[3],k=n[7],p=n[11],z=n[15],w=s[0],M=s[4],g=s[8],b=s[12],S=s[1],q=s[5],P=s[9],A=s[13],T=s[2],F=s[6],V=s[10],C=s[14],O=s[3],X=s[7],Y=s[11],Z=s[15];return e[0]=r*w+h*S+a*T+u*O,e[4]=r*M+h*q+a*F+u*X,e[8]=r*g+h*P+a*V+u*Y,e[12]=r*b+h*A+a*C+u*Z,e[1]=o*w+l*S+c*T+y*O,e[5]=o*M+l*q+c*F+y*X,e[9]=o*g+l*P+c*V+y*Y,e[13]=o*b+l*A+c*C+y*Z,e[2]=v*w+d*S+f*T+m*O,e[6]=v*M+d*q+f*F+m*X,e[10]=v*g+d*P+f*V+m*Y,e[14]=v*b+d*A+f*C+m*Z,e[3]=x*w+k*S+p*T+z*O,e[7]=x*M+k*q+p*F+z*X,e[11]=x*g+k*P+p*V+z*Y,e[15]=x*b+k*A+p*C+z*Z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,i=t[0],e=t[4],n=t[8],s=t[12],r=t[1],h=t[5],a=t[9],u=t[13],o=t[2],l=t[6],c=t[10],y=t[14],v=i*h,d=i*a,f=i*u,m=e*r,x=e*a,k=e*u,p=n*r,z=n*h,w=n*u,M=s*r,g=s*h,b=s*a;return t[3]*(b*l-w*l-g*c+k*c+z*y-x*y)+t[7]*(d*y-f*c+M*c-p*y+w*o-b*o)+t[11]*(f*l-v*y-M*l+m*y+g*o-k*o)+t[15]*(-z*o-d*l+v*c+p*l-m*c+x*o)}},{key:"getInverse",value:function(t){var i=this.elements,e=t.elements,n=e[0],s=e[1],r=e[2],h=e[3],a=e[4],u=e[5],o=e[6],l=e[7],c=e[8],y=e[9],v=e[10],d=e[11],f=e[12],m=e[13],x=e[14],k=e[15],p=y*x*l-m*v*l+m*o*d-u*x*d-y*o*k+u*v*k,z=f*v*l-c*x*l-f*o*d+a*x*d+c*o*k-a*v*k,w=c*m*l-f*y*l+f*u*d-a*m*d-c*u*k+a*y*k,M=f*y*o-c*m*o-f*u*v+a*m*v+c*u*x-a*y*x,g=n*p+s*z+r*w+h*M,b=void 0;return 0!==g?(b=1/g,i[0]=p*b,i[1]=(m*v*h-y*x*h-m*r*d+s*x*d+y*r*k-s*v*k)*b,i[2]=(u*x*h-m*o*h+m*r*l-s*x*l-u*r*k+s*o*k)*b,i[3]=(y*o*h-u*v*h-y*r*l+s*v*l+u*r*d-s*o*d)*b,i[4]=z*b,i[5]=(c*x*h-f*v*h+f*r*d-n*x*d-c*r*k+n*v*k)*b,i[6]=(f*o*h-a*x*h-f*r*l+n*x*l+a*r*k-n*o*k)*b,i[7]=(a*v*h-c*o*h+c*r*l-n*v*l-a*r*d+n*o*d)*b,i[8]=w*b,i[9]=(f*y*h-c*m*h-f*s*d+n*m*d+c*s*k-n*y*k)*b,i[10]=(a*m*h-f*u*h+f*s*l-n*m*l-a*s*k+n*u*k)*b,i[11]=(c*u*h-a*y*h-c*s*l+n*y*l+a*s*d-n*u*d)*b,i[12]=M*b,i[13]=(c*m*r-f*y*r+f*s*v-n*m*v-c*s*x+n*y*x)*b,i[14]=(f*u*r-a*m*r-f*s*o+n*m*o+a*s*x-n*u*x)*b,i[15]=(a*y*r-c*u*r+c*s*o-n*y*o-a*s*v+n*u*v)*b):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,i=void 0;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}},{key:"scale",value:function(t,i,e){var n=this.elements;return n[0]*=t,n[4]*=i,n[8]*=e,n[1]*=t,n[5]*=i,n[9]*=e,n[2]*=t,n[6]*=i,n[10]*=e,n[3]*=t,n[7]*=i,n[11]*=e,this}},{key:"makeScale",value:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=1-e,r=t.x,h=t.y,a=t.z,u=s*r,o=s*h;return this.set(u*r+e,u*h-n*a,u*a+n*h,0,u*h+n*a,o*h+e,o*a-n*r,0,u*a-n*h,o*a+n*r,s*a*a+e,0,0,0,0,1),this}},{key:"makeShear",value:function(t,i,e){return this.set(1,i,e,0,t,1,e,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(t,i,e){return this.makeRotationFromQuaternion(i),this.scale(e.x,e.y,e.z),this.setPosition(t),this}},{key:"decompose",value:function(t,i,e){var n=this.elements,s=n[0],r=n[1],h=n[2],a=n[4],u=n[5],o=n[6],l=n[8],c=n[9],y=n[10],v=this.determinant(),d=Z.set(s,r,h).length()*(v<0?-1:1),f=Z.set(a,u,o).length(),m=Z.set(l,c,y).length(),x=1/d,k=1/f,p=1/m;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=x,n[1]*=x,n[2]*=x,n[4]*=k,n[5]*=k,n[6]*=k,n[8]*=p,n[9]*=p,n[10]*=p,i.setFromRotationMatrix(this),n[0]=s,n[1]=r,n[2]=h,n[4]=a,n[5]=u,n[6]=o,n[8]=l,n[9]=c,n[10]=y,e.x=d,e.y=f,e.z=m,this}},{key:"makePerspective",value:function(t,i,e,n,s,r){var h=this.elements,a=2*s/(i-t),u=2*s/(e-n),o=(i+t)/(i-t),l=(e+n)/(e-n),c=-(r+s)/(r-s),y=-2*r*s/(r-s);return h[0]=a,h[4]=0,h[8]=o,h[12]=0,h[1]=0,h[5]=u,h[9]=l,h[13]=0,h[2]=0,h[6]=0,h[10]=c,h[14]=y,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}},{key:"makeOrthographic",value:function(t,i,e,n,s,r){var h=this.elements,a=1/(i-t),u=1/(e-n),o=1/(r-s),l=(i+t)*a,c=(e+n)*u,y=(r+s)*o;return h[0]=2*a,h[4]=0,h[8]=0,h[12]=-l,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-c,h[2]=0,h[6]=0,h[10]=-2*o,h[14]=-y,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<16;++s)i[s]!==e[s]&&(n=!1);return n}}])}(),new w),_=new w,R=(function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.normal=i,this.constant=e}m(t,[{key:"set",value:function(t,i){return this.normal.copy(t),this.constant=i,this}},{key:"setComponents",value:function(t,i,e,n){return this.normal.set(t,i,e),this.constant=n,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,i,e){var n=E.subVectors(e,i).cross(_.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,E),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,i){var e=t.delta(E),n=this.normal.dot(e);if(0===n)0===this.distanceToPoint(t.start)&&i.copy(t.start);else{var s=-(t.start.dot(this.normal)+this.constant)/n;s>=0&&s<=1&&i.copy(e).multiplyScalar(s).add(t.start)}return i}},{key:"intersectsLine",value:function(t){var i=this.distanceToPoint(t.start),e=this.distanceToPoint(t.end);return i<0&&e>0||e<0&&i>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}])}(),function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),this.radius=i,this.phi=e,this.theta=n}m(t,[{key:"set",value:function(t,i,e){return this.radius=t,this.phi=i,this.theta=e,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}])}(),function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}m(t,[{key:"set",value:function(t,i,e,n,s,r){var h=this.elements;return h[0]=t,h[1]=i,h[3]=n,h[2]=e,h[4]=s,h[5]=r,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var i=t.elements;return this.set(i[0],i[1],i[2],i[3],i[4],i[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var i=t.elements;t.set(i[0],i[1],i[2],i[1],i[3],i[4],i[2],i[4],i[5])}},{key:"add",value:function(t){var i=this.elements,e=t.elements;return i[0]+=e[0],i[1]+=e[1],i[3]+=e[3],i[2]+=e[2],i[4]+=e[4],i[5]+=e[5],this}},{key:"norm",value:function(){var t=this.elements,i=t[1]*t[1],e=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+i+e+i+t[3]*t[3]+n+e+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var i=t.x,e=t.y,n=t.z,s=this.elements;return t.x=s[0]*i+s[1]*e+s[2]*n,t.y=s[1]*i+s[3]*e+s[4]*n,t.z=s[2]*i+s[4]*e+s[5]*n,t}},{key:"equals",value:function(t){var i=this.elements,e=t.elements,n=!0,s=void 0;for(s=0;n&&s<6;++s)i[s]!==e[s]&&(n=!1);return n}}],[{key:"calculateIndex",value:function(t,i){return 3-(3-t)*(2-t)/2+i}}])}(),function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;f(this,t),this.x=i,this.y=e,this.z=n,this.w=s}m(t,[{key:"set",value:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var i=.01,e=t.elements,n=e[0],s=e[4],r=e[8],h=e[1],a=e[5],u=e[9],o=e[2],l=e[6],c=e[10],y=void 0,v=void 0,d=void 0,f=void 0,m=void 0,x=void 0,k=void 0,p=void 0,z=void 0,w=void 0,M=void 0;return Math.abs(s-h)<i&&Math.abs(r-o)<i&&Math.abs(u-l)<i?Math.abs(s+h)<.1&&Math.abs(r+o)<.1&&Math.abs(u+l)<.1&&Math.abs(n+a+c-3)<.1?this.set(1,0,0,0):(y=Math.PI,k=(c+1)/2,p=(s+h)/4,z=(r+o)/4,w=(u+l)/4,(m=(n+1)/2)>(x=(a+1)/2)&&m>k?m<i?(v=0,d=.707106781,f=.707106781):(d=p/(v=Math.sqrt(m)),f=z/v):x>k?x<i?(v=.707106781,d=0,f=.707106781):(v=p/(d=Math.sqrt(x)),f=w/d):k<i?(v=.707106781,d=.707106781,f=0):(v=z/(f=Math.sqrt(k)),d=w/f),this.set(v,d,f,y)):(M=Math.sqrt((l-u)*(l-u)+(r-o)*(r-o)+(h-s)*(h-s)),Math.abs(M)<.001&&(M=1),this.x=(l-u)/M,this.y=(r-o)/M,this.z=(h-s)/M,this.w=Math.acos((n+a+c-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var i=this.x,e=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*i+r[4]*e+r[8]*n+r[12]*s,this.y=r[1]*i+r[5]*e+r[9]*n+r[13]*s,this.z=r[2]*i+r[6]*e+r[10]*n+r[14]*s,this.w=r[3]*i+r[7]*e+r[11]*n+r[15]*s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z,s=this.w-t.w;return i*i+e*e+n*n+s*s}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}},{key:"lerpVectors",value:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}])}(),new w),j=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w;f(this,t),this.min=i,this.max=e,this.children=null}return m(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,i=this.max,e=this.getCenter(R),n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=I[s],n[s]=new this.constructor(new w(0===r[0]?t.x:e.x,0===r[1]?t.y:e.y,0===r[2]?t.z:e.z),new w(0===r[0]?e.x:i.x,0===r[1]?e.y:i.y,0===r[2]?e.z:i.z))}}]),t}(),I=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],D=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Q=new w,L=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.min=i,this.size=e,this.children=null}return m(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,i=this.getCenter(Q),e=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=I[s],n[s]=new this.constructor(new w(0===r[0]?t.x:i.x,0===r[1]?t.y:i.y,0===r[2]?t.z:i.z),e)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),N=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(this,t),this.value=i,this.done=e}return m(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}(),G=new g,H=function(){function t(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(this,t),this.octree=i,this.region=e,this.cull=null!==e,this.result=new N,this.trace=null,this.indices=null,this.reset()}return m(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(G.min=t.min,G.max=t.max,this.cull&&!this.region.intersectsBox(G)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,i=this.region,e=this.indices,n=this.trace,s=null,r=n.length-1,h=void 0,a=void 0,u=void 0;null===s&&r>=0;)if(h=e[r],a=n[r].children,++e[r],h<8)if(null!==a){if(u=a[h],t&&(G.min=u.min,G.max=u.max,!i.intersectsBox(G)))continue;n.push(u),e.push(0),++r}else s=n.pop(),e.pop();else n.pop(),e.pop(),--r;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),J=new Uint8Array([0,1,2,3,4,5,6,7,0]),K=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],W=new w,$=new w,tt=new w,it=new w,et=new w,nt=new w,st=new w,rt=function(){function t(){f(this,t)}return m(t,null,[{key:"intersectOctree",value:function(t,i,e){var n=void 0,r=void 0,h=void 0,a=void 0,u=void 0,o=void 0,l=void 0,c=void 0,y=void 0;t.getDimensions(W),$.copy(W).multiplyScalar(.5),it.copy(t.min).sub(t.min),et.copy(t.max).sub(t.min),nt.copy(i.ray.direction),st.copy(i.ray.origin),st.sub(t.getCenter(tt)).add($),J[8]=J[0],nt.x<0&&(st.x=W.x-st.x,nt.x=-nt.x,J[8]|=J[4]),nt.y<0&&(st.y=W.y-st.y,nt.y=-nt.y,J[8]|=J[2]),nt.z<0&&(st.z=W.z-st.z,nt.z=-nt.z,J[8]|=J[1]),n=1/nt.x,r=1/nt.y,h=1/nt.z,a=(it.x-st.x)*n,u=(et.x-st.x)*n,o=(it.y-st.y)*r,l=(et.y-st.y)*r,c=(it.z-st.z)*h,y=(et.z-st.z)*h,Math.max(Math.max(a,o),c)<Math.min(Math.min(u,l),y)&&s(t.root,a,o,c,u,l,y,i,e)}}]),t}(),ht=new g,at=function(){function t(i,e){f(this,t),this.root=void 0!==i&&void 0!==e?new j(i,e):null}return m(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return r(this.root)}},{key:"cull",value:function(t){var i=[];return h(this.root,t,i),i}},{key:"findOctantsByLevel",value:function(t){var i=[];return a(this.root,t,0,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return rt.intersectOctree(this,t,i),i}},{key:"leaves",value:function(t){return new H(this,t)}},{key:Symbol.iterator,value:function(){return new H(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),ut=new w,ot=function(t){function i(t,e){f(this,i);var n=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e));return n.points=null,n.data=null,n}return k(i,j),m(i,[{key:"distanceToSquared",value:function(t){return ut.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var i=this.getCenter(ut),e=t.x-i.x,n=t.y-i.x,s=t.z-i.z;return e*e+n*n+s*s}},{key:"contains",value:function(t,i){var e=this.min,n=this.max;return t.x>=e.x-i&&t.y>=e.y-i&&t.z>=e.z-i&&t.x<=n.x+i&&t.y<=n.y+i&&t.z<=n.z+i}},{key:"redistribute",value:function(t){var i=this.children,e=this.points,n=this.data,s=void 0,r=void 0,h=void 0,a=void 0,u=void 0,o=void 0,l=void 0;if(null!==i)for(s=0,h=e.length;s<h;++s)for(o=e[s],l=n[s],r=0,a=i.length;r<a;++r)if((u=i[r]).contains(o,t)){null===u.points&&(u.points=[],u.data=[]),u.points.push(o),u.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,i=void 0,e=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],i=0,e=t.length;i<e;++i)if(null!==(n=t[i]).points){var s,r;(s=this.points).push.apply(s,z(n.points)),(r=this.data).push.apply(r,z(n.data))}this.children=null}}}]),i}(),lt=function t(i,e,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;f(this,t),this.distance=i,this.distanceToRay=e,this.point=n,this.object=s},ct=1e-6,yt=function(t){function i(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;f(this,i);var h=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return h.root=new ot(t,e),h.bias=Math.max(0,n),h.maxPoints=Math.max(1,Math.round(s)),h.maxDepth=Math.max(0,Math.round(r)),h.pointCount=0,h}return k(i,at),m(i,[{key:"countPoints",value:function(t){return u(t)}},{key:"put",value:function(t,i){return o(t,i,this,this.root,0)}},{key:"remove",value:function(t){return l(t,this,this.root,null)}},{key:"fetch",value:function(t){return c(t,this,this.root)}},{key:"move",value:function(t,i){return y(t,i,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return v(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,i){var e=[];return d(t,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=x(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,e),e}},{key:"testPoints",value:function(t,i,e){var n=i.params.Points.threshold,s=n*n,r=void 0,h=void 0,a=void 0,u=void 0,o=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,f=void 0;for(o=0,c=t.length;o<c;++o)if(v=t[o],null!==(d=v.points))for(l=0,y=d.length;l<y;++l)f=d[l],(u=i.ray.distanceSqToPoint(f))<s&&(r=i.ray.closestPointToPoint(f),(h=i.ray.origin.distanceTo(r))>=i.near&&h<=i.far&&(a=Math.sqrt(u),e.push(new lt(h,a,r,v.data[l]))))}}]),i}(),vt=function(){function t(){f(this,t)}return m(t,null,[{key:"recycleOctants",value:function(t,i){var e=new w,n=new w,s=new w,r=t.min,h=t.getCenter(),a=t.getDimensions().multiplyScalar(.5),u=t.children,o=i.length,l=void 0,c=void 0,y=void 0,v=void 0;for(l=0;l<8;++l)for(y=I[l],n.addVectors(r,e.fromArray(y).multiply(a)),s.addVectors(h,e.fromArray(y).multiply(a)),c=0;c<o;++c)if(null!==(v=i[c])&&n.equals(v.min)&&s.equals(v.max)){u[l]=v,i[c]=null;break}}}]),t}();t.CubicOctant=L,t.edges=D,t.Octant=j,t.Octree=at,t.OctantIterator=H,t.OctreeRaycaster=rt,t.pattern=I,t.PointOctant=ot,t.PointOctree=yt,t.RayPointIntersection=lt,t.OctreeUtils=vt,Object.defineProperty(t,"__esModule",{value:!0})});